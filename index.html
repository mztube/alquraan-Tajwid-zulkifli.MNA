<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mushaf — Al-Qur'an (Juz 1) Tajwid & Terjemahan Melayu</title>
  <meta name="description" content="Mushaf klasik gaya modern — Tajwid berwarna & terjemahan Melayu. Setiap surah satu halaman. Audio (jika tersedia)." />
  <!-- Google font untuk Noto Naskh Arabic (Arabic display) and a clean Latin -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Noto+Naskh+Arabic:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f3fbf6;        /* hijau lembut */
      --mushaf:#f8f7ee;
      --accent:#1f6f4b;
      --muted:#666;
      --card:#ffffff;
      --maxw:900px;
      --arab-size:34px;
      --trans-size:17px;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter, Arial, sans-serif;color:#111}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:18px}
    header{background:var(--accent);color:#fff;padding:18px;border-radius:8px;text-align:center}
    header h1{margin:0;font-size:20px;font-weight:600}
    header p{margin:6px 0 0 0;font-size:13px;opacity:.95}
    /* page (mushaf layout) */
    .mushaf-page{background:var(--mushaf);border-radius:12px;padding:18px;margin-top:16px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    .mushaf-top{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:10px}
    .mushaf-title{font-weight:700;font-size:18px;color:#083a2f}
    .mushaf-meta{font-size:13px;color:var(--muted)}
    /* arabic text block */
    .arab-block{background:#fff;padding:18px;border-radius:10px;border:1px solid #e6e6e0}
    .arabic{direction:rtl;font-family:'Noto Naskh Arabic', serif;font-size:var(--arab-size);line-height:1.6;text-align:right;letter-spacing:0.6px}
    .aya-number{display:inline-block;margin-left:8px;background:var(--accent);color:#fff;padding:3px 8px;border-radius:12px;font-size:13px}
    .translation{font-size:var(--trans-size);color:#222;margin-top:12px;background:#fff;padding:14px;border-radius:10px;border:1px solid #eee}
    .controls{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    button.play{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    .note{font-size:13px;color:var(--muted)}
    /* tajwid colors (standard-ish) */
    .tj-madd{color:#006400;font-weight:700}       /* hijau gelap */
    .tj-idgham{color:#ff6600;font-weight:700}     /* oren */
    .tj-ikhfa{color:#990099;font-weight:700}      /* ungu */
    .tj-qalqalah{color:#0047ab;font-weight:700}   /* biru */
    .tj-ghunnah{color:#c8102e;font-weight:700}    /* merah */
    .tj-iqlab{color:#ff9900;font-weight:700}      /* kuning/orange */
    .tj-idhar{color:#008fb3;font-weight:700}      /* biru muda */
    /* legend */
    .legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .legend .item{background:#fff;padding:8px;border-radius:8px;border:1px solid #eee;font-size:13px}
    footer{margin-top:18px;padding:12px;color:var(--muted);font-size:13px;text-align:center}
    /* responsive */
    @media (max-width:540px){
      :root{--arab-size:26px;--trans-size:15px}
      .wrap{padding:12px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>المصحف — Al-Qur'an (Juz 1)</h1>
      <p>Gaya klasik mushaf + Tajwid berwarna • Terjemahan Bahasa Melayu • Audio (jika ada)</p>
    </header>

    <!-- page container for surah display -->
    <div id="pageContainer" class="mushaf-page">
      <div class="mushaf-top">
        <div class="mushaf-title" id="surahTitle">Memuatkan Surah...</div>
        <div class="mushaf-meta" id="surahMeta">Juz 1 • Halaman 1</div>
      </div>

      <div class="arab-block" id="arabBlock">
        <div id="arabContent" class="arabic">—</div>
      </div>

      <div id="translation" class="translation">Memuatkan terjemahan...</div>

      <div class="controls" id="controls" style="display:none">
        <button id="playBtn" class="play">▶️ Mainkan Surah</button>
        <div class="note" id="audioNote">Audio: Tiada sumber audio ditemui.</div>
      </div>

      <div class="legend" id="legend">
        <div class="item"><span class="tj-madd">Hijau</span> — Mad</div>
        <div class="item"><span class="tj-idgham">Oren</span> — Idgham</div>
        <div class="item"><span class="tj-ikhfa">Ungu</span> — Ikhfa'</div>
        <div class="item"><span class="tj-qalqalah">Biru</span> — Qalqalah</div>
        <div class="item"><span class="tj-ghunnah">Merah</span> — Ghunnah</div>
      </div>
    </div>

    <footer>
      <div>Nota: Tajwid berwarna akan dipaparkan jika API tajwid mengembalikan teks beserta markup warna. Audio bergantung pada sumber awam (jika tersedia).</div>
    </footer>
  </div>

<script>
/*
  Template single-file yang muatkan surah/ayat, cuba fetch:
   - Tajwid (jika ada) : saya cuba gunakan endpoint awam (contoh: api.alif.my.id/...).
   - Terjemahan Melayu : contoh endpoint public.
   - Audio: cuba alafasy/alabdulbasit CDN pattern (jika ada).
  Jika anda mahu teruskan untuk keseluruhan Juz 1, saya boleh bantu langkah seterusnya.
*/

const surahNo = 1; // default buka Surah 1 (Anda boleh tukar ke nombor mengikut halaman)
const surahTitleEl = document.getElementById('surahTitle');
const surahMetaEl = document.getElementById('surahMeta');
const arabContent = document.getElementById('arabContent');
const translationEl = document.getElementById('translation');
const controls = document.getElementById('controls');
const playBtn = document.getElementById('playBtn');
const audioNote = document.getElementById('audioNote');
let audioUrl = '';

// API endpoints (best-effort). Jika organisasi API berubah, gantikan pautan di sini.
const API_TAJWID = n => `https://api.alif.my.id/alquran/${n}/tajwid`;      // cuba ambil tajwid markup
const API_TRANS = n => `https://api.surah.my/surah/${n}`;                 // cuba ambil translation Melayu
const API_ARAB = n => `https://api.alquran.cloud/v1/surah/${n}`;         // fallback: arabic text (Uthmani)

/* helper safe fetch + json */
async function safeFetchJSON(url){
  try{
    const r = await fetch(url);
    if(!r.ok) return null;
    return await r.json().catch(()=>null);
  }catch(e){
    return null;
  }
}

/* Attempt load data */
async function loadSurah(n){
  surahTitleEl.textContent = 'Memuatkan...';
  arabContent.textContent = '';
  translationEl.textContent = '';
  controls.style.display='none';
  audioUrl='';

  // Try: tajwid api (preferred)
  const [tajwidJson, transJson, arabJson] = await Promise.all([
    safeFetchJSON(API_TAJWID(n)),
    safeFetchJSON(API_TRANS(n)),
    safeFetchJSON(API_ARAB(n))
  ]);

  // Title & meta
  let surahName = `Surah ${n}`;
  if(arabJson && arabJson.data && arabJson.data.englishName){
    surahName = `${arabJson.data.englishName} — ${arabJson.data.name}`;
    surahMetaEl.textContent = `Surah ${n} • ${arabJson.data.revelationType} • ${arabJson.data.numberOfAyahs} ayat`;
  } else {
    surahMetaEl.textContent = `Juz 1`;
  }
  surahTitleEl.textContent = surahName;

  // Try to obtain arabic with tajwid (if tajwid API returns HTML markup)
  if(tajwidJson && tajwidJson.data && tajwidJson.data.ayahs && tajwidJson.data.ayahs.length>0){
    // join all ayah html (many tajwid APIs include <span class="tj-...">)
    try{
      const parts = tajwidJson.data.ayahs.map(a=> a.text || a.ar || a.arabic || '');
      // combine with space/line breaks
      arabContent.innerHTML = parts.map((p,i)=> `<div style="margin-bottom:6px">${p} <span class="aya-number">${i+1}</span></div>`).join('');
    }catch(e){
      arabContent.textContent = 'Tidak dapat memaparkan tajwid (format tidak disokong).';
    }
  } else if(arabJson && arabJson.data && arabJson.data.ayahs){
    // fallback to alquran.cloud arabic Uthmani text
    const ayahs = arabJson.data.ayahs.map(a => a.text);
    arabContent.innerHTML = ayahs.map((t,i)=> `<div style="margin-bottom:6px">${escapeHtml(t)} <span class="aya-number">${i+1}</span></div>`).join('');
  } else {
    arabContent.textContent = '⚠️ Gagal memuat ayat Arabic. Sila cuba semula.';
  }

  // Translation: prefer transJson (surah.my)
  if(transJson && transJson.ayahs){
    // surah.my structure may vary; attempt common shapes
    const trs = transJson.ayahs.map(a => a.translation || a.text || a.translation_text || (a.translation && a.translation[0] && a.translation[0].text) || '');
    translationEl.textContent = trs.join('\n\n');
  } else if(arabJson && arabJson.data && arabJson.data.ayahs){
    // try english or simple translation from alquran.cloud if available (many editions provide english only)
    const trans = arabJson.data.ayahs.map(a => a.translation || a.text || '');
    const joined = trans.filter(Boolean).join('\n\n');
    translationEl.textContent = joined || 'Terjemahan tidak tersedia dari sumber semasa.';
  } else {
    translationEl.textContent = 'Terjemahan tidak dapat dimuatkan.';
  }

  // Audio: try alquran.cloud audio edition ar.alafasy or ar.abdulbasitmurattal via common CDN
  // We'll attempt a typical CDN pattern for full surah:
  //  - https://cdn.islamic.network/quran/audio/128/ar.alafasy/{surah}.mp3  (may or may not exist)
  const tryUrls = [
    `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${n}.mp3`,
    `https://cdn.islamic.network/quran/audio/128/ar.abdulbasitmurattal/${n}.mp3`,
    `https://cdn.alquran.cloud/media/audio/ayah/ar.alafasy/${n}`
  ];
  // Try fetch HEAD to see if exists
  for(const u of tryUrls){
    try{
      const r = await fetch(u, {method:'HEAD'});
      if(r.ok){
        audioUrl = u;
        break;
      }
    }catch(e){}
  }
  if(audioUrl){
    controls.style.display='flex';
    audioNote.textContent = 'Audio tersedia — tekan Mainkan.';
    playBtn.onclick = ()=> {
      const a = new Audio(audioUrl);
      a.play().catch(err => alert('Audio tidak dapat dimainkan: '+err.message));
    };
  } else {
    controls.style.display='none';
  }
}

/* small helper to escape text when inserting as textContent fallback */
function escapeHtml(s){
  if(!s) return '';
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// load default surah
loadSurah(surahNo);
</script>
</body>
</html>