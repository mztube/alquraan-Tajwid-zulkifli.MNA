<!-- save as index.html (single-file site) -->
<!doctype html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Al-Qur'an Mushaf — Juz 1 (Mushaf klasik + Tajwid warna)</title>
<meta name="description" content="Mushaf gaya klasik — teks Al-Qur'an (Uthmani), tajwid warna, terjemahan Melayu. Pilih reciter untuk audio (AbdulBasit, Alafasy, Mishary, dll)." />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<!-- Arabic-friendly font (if not available device fallback used) -->
<link href="https://fonts.googleapis.com/css2?family=Lateef&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#eef7ef;
    --panel:#ffffff;
    --accent:#2f6b46; /* hijau */
    --muted:#617068;
    --verse-bg:#ffffff;
    --num-bg:#2f6b46;
    --shadow: 0 6px 18px rgba(0,0,0,0.06);
    --maxw:900px;
    --arabic-font: "Lateef", "Noto Naskh Arabic", "Amiri", serif;
  }
  html,body{height:100%;margin:0;font-family:Inter, Arial, sans-serif;background:var(--bg);color:#1b2b22}
  .wrap{max-width:var(--maxw);margin:14px auto;padding:16px}
  header{background:var(--accent);color:#fff;padding:20px;border-radius:10px;text-align:center;box-shadow:var(--shadow)}
  header h1{margin:0;font-size:20px;font-weight:700}
  header p{margin:6px 0 0 0;opacity:.95}
  .top-controls{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:12px;flex-wrap:wrap}
  .panel{background:var(--panel);border-radius:12px;padding:14px;margin-top:14px;box-shadow:var(--shadow)}
  .surah-head{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .surah-title{font-weight:700;color:var(--accent)}
  .meta{color:var(--muted);font-size:13px}
  select, button{padding:8px 10px;border-radius:8px;border:1px solid #d6e6db;font-size:14px;background:#fff}
  button.primary{background:var(--accent);color:#fff;border:0}
  .mushaf{margin-top:14px;padding:18px;background:linear-gradient(180deg,#fff,#fbfff9);border-radius:12px;border:1px solid rgba(0,0,0,0.03)}
  .ayah-block{background:var(--verse-bg);border-radius:8px;padding:18px;margin:14px 0;position:relative;border:1px solid #e6efe6}
  .arabic{font-family:var(--arabic-font);direction:rtl;text-align:right;font-size:36px;line-height:1.6;letter-spacing:1px;color:#111}
  .verse-number{position:absolute;left:18px;top:18px;width:36px;height:36px;border-radius:50%;background:var(--num-bg);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
  .translation{margin-top:14px;color:#333;background:transparent;padding:12px;border-radius:8px;font-size:16px;line-height:1.6}
  .tajwid-legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .legend-item{background:#fff;padding:8px;border-radius:8px;border:1px solid #e6efe6;font-size:13px}
  /* Tajwid colour classes (standard-ish) */
  .tj-madd{color:#008000}         /* hijau */
  .tj-idgham{color:#ff6600}       /* oren */
  .tj-ikhfa{color:#990099}        /* ungu */
  .tj-qalqalah{color:#0000cc}     /* biru */
  .tj-ghunnah{color:#ff0000}      /* merah */
  .tj-iqlab{color:#ff9900}        /* kuning/orange */
  .tj-idhar{color:#0099cc}        /* biru muda */
  /* player controls */
  .audio-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:12px}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:18px;padding:12px;border-radius:10px;background:#f6fff6;color:var(--muted);font-size:13px}
  @media(max-width:520px){
    .arabic{font-size:28px}
    .verse-number{left:12px;top:12px;width:30px;height:30px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>المصحف — Al-Qur'an (Juz 1)</h1>
      <p>Gaya mushaf klasik • Tajwid berwarna • Terjemahan Melayu • Audio reciter boleh dipilih</p>
    </header>

    <div class="top-controls">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <label class="small">Pilih Surah</label>
        <select id="surahSelect" title="Pilih surah"></select>

        <label class="small" style="margin-left:10px">Reciter</label>
        <select id="reciterSelect" title="Pilih reciter">
          <option value="ar.alafasy">Alafasy</option>
          <option value="ar.abdulbasitmurattal">Abdul Basit</option>
          <option value="ar.mishary">Mishary</option>
          <option value="ar.husary">Husary</option>
          <option value="ar.sayid">Sayid (jika tersedia)</option>
        </select>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <button id="playSurahBtn" class="primary">▶ Main Surah</button>
        <button id="stopBtn">■ Henti</button>
      </div>
    </div>

    <div id="status" class="panel small" style="margin-top:12px">Memuatkan...</div>

    <div id="mushaf" class="mushaf panel" style="display:none">
      <div class="surah-head">
        <div>
          <div class="surah-title" id="surahName">—</div>
          <div class="meta" id="surahMeta"></div>
        </div>
        <div class="small">Juz berpaut kepada tiap surah (jika berkaitan)</div>
      </div>

      <div id="ayahContainer" style="margin-top:12px"></div>

      <div class="panel" style="margin-top:12px">
        <div class="tajwid-legend">
          <div class="legend-item"><span class="tj-madd">Hijau</span> — Mad (panjangkan)</div>
          <div class="legend-item"><span class="tj-idgham">Oren</span> — Idgham</div>
          <div class="legend-item"><span class="tj-ikhfa">Ungu</span> — Ikhfa'</div>
          <div class="legend-item"><span class="tj-qalqalah">Biru</span> — Qalqalah</div>
          <div class="legend-item"><span class="tj-ghunnah">Merah</span> — Ghunnah</div>
        </div>
      </div>
    </div>

    <footer>
      <div>Nota: Sistem cuba muat data Arab & terjemahan dari API awam (alquran.cloud & lain). Jika terjemahan Melayu tidak dipaparkan, cuba pilih surah lain atau pastikan sambungan internet. Audio bergantung pada reciter & data API.</div>
    </footer>
  </div>

<script>
/*
  Single-file "mushaf" viewer:
  - Isi dropdown surah 1..114
  - Ambil data Arabic & terjemahan dari alquran.cloud atau fallback
  - Audio: gunakan endpoint alquran.cloud per-surah dengan edition reciter (e.g. ar.alafasy)
  - Paparkan setiap ayah dalam kotak (nombor ayat di bulatan hijau)
  - Tajwid: many APIs may include markup or tajwid classes; this script will insert Arabic HTML if tags present;
    otherwise plain text. Tajwid colour mapping CSS classes provided above for future markup.
*/

const surahNames = [
  "Al-Fatihah", "Al-Baqarah", "Ali 'Imran", "An-Nisa’", "Al-Ma’idah", "Al-An’am", "Al-A’raf",
  "Al-Anfal", "At-Taubah", "Yunus", "Hud", "Yusuf", "Ar-Ra’d", "Ibrahim", "Al-Hijr", "An-Nahl",
  "Al-Isra’", "Al-Kahf", "Maryam", "Taha", "Al-Anbiya’", "Al-Hajj", "Al-Mu’minun", "An-Nur",
  "Al-Furqan", "Ash-Shu’ara’", "An-Naml", "Al-Qasas", "Al-Ankabut", "Ar-Rum", "Luqman", "As-Sajdah",
  "Al-Ahzab", "Saba’", "Fatir", "Ya Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat",
  "Ash-Shura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiyah", "Al-Ahqaf", "Muhammad", "Al-Fath",
  "Al-Hujurat", "Qaf", "Adh-Dhariyat", "At-Tur", "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi’ah",
  "Al-Hadid", "Al-Mujadilah", "Al-Hashr", "Al-Mumtahanah", "As-Saff", "Al-Jumu’ah", "Al-Munafiqun",
  "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma’arij",
  "Nuh", "Al-Jinn", "Al-Muzzammil", "Al-Muddathir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat",
  "An-Naba’", "An-Nazi’at", "Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq",
  "Al-Buruj", "At-Tariq", "Al-A’la", "Al-Ghashiyah", "Al-Fajr", "Al-Balad", "Ash-Shams", "Al-Layl",
  "Ad-Duhaa", "Ash-Sharh", "At-Tin", "Al-‘Alaq", "Al-Qadr", "Al-Bayyinah", "Az-Zalzalah",
  "Al-‘Adiyat", "Al-Qari’ah", "At-Takathur", "Al-‘Asr", "Al-Humazah", "Al-Fil", "Quraysh",
  "Al-Ma’un", "Al-Kawthar", "Al-Kafirun", "An-Nasr", "Al-Masad", "Al-Ikhlas", "Al-Falaq", "An-Nas"
];

let currentAudio = null;
let audioQueue = [];
let isPlayingQueue = false;

for (let i = 1; i <= 114; i++) {
  const o = document.createElement('option');
  o.value = i;
  o.textContent = `${i}. Surah ${surahNames[i - 1]}`;
  surahSelect.appendChild(o);
}

// helper: try to fetch JSON safely
async function tryFetch(url){
  try{
    const res = await fetch(url);
    if(!res.ok) return null;
    return await res.json();
  }catch(e){
    return null;
  }
}

async function loadSurah(surahNum){
  statusEl.textContent = 'Memuat surah...';
  mushafEl.style.display = 'none';
  ayahContainer.innerHTML = '';
  currentAudio = null;
  audioQueue = [];
  isPlayingQueue = false;

  // try primary Arabic + reciter audio from alquran.cloud
  const arabicUrl = `https://api.alquran.cloud/v1/surah/${surahNum}/quran-uthmani`; // Arabic Uthmani edition
  const translationUrlCandidates = [
    `https://api.alquran.cloud/v1/surah/${surahNum}/ms.syahadah`, // try Malay editions
    `https://api.alquran.cloud/v1/surah/${surahNum}/ms.bahasa`, 
    `https://api.alquran.cloud/v1/surah/${surahNum}/en.translator` // fallback (not Malay)
  ];

  const arabicJson = await tryFetch(arabicUrl);

  // get translation (first that works)
  let transJson = null;
  for(const url of translationUrlCandidates){
    const j = await tryFetch(url);
    if(j && j.data && j.data.ayahs) { transJson = j; break; }
  }

  // surah meta
  if(arabicJson && arabicJson.data){
    surahName.textContent = `${arabicJson.data.englishName} — ${arabicJson.data.name}`;
    surahMeta.textContent = `Surah ${arabicJson.data.englishName} • ${arabicJson.data.revelationType} • ${arabicJson.data.numberOfAyahs} ayat`;
  } else {
    surahName.textContent = `Surah ${surahNum}`;
    surahMeta.textContent = `Surah nombor ${surahNum}`;
  }

  // fetch audio per-ayah from selected reciter (try alquran.cloud edition)
  const reciter = reciterSelect.value || 'ar.alafasy';
  const audioJson = await tryFetch(`https://api.alquran.cloud/v1/surah/${surahNum}/${reciter}`);
  // audioJson.data.ayahs[n].audio may exist in some editions. We'll collect ayah audio URLs if present.
  const ayahAudioUrls = [];
  if(audioJson && audioJson.data && audioJson.data.ayahs){
    audioJson.data.ayahs.forEach(a => {
      // try common fields
      if(a.audio) ayahAudioUrls.push(a.audio);
      else if(a.audioSecondary && a.audioSecondary.length) ayahAudioUrls.push(a.audioSecondary[0]);
      else ayahAudioUrls.push(null);
    });
  }

  // decide source of Arabic text: prefer arabicJson, else audioJson.data
  const ayahs = (arabicJson && arabicJson.data && arabicJson.data.ayahs) ? arabicJson.data.ayahs : (audioJson && audioJson.data && audioJson.data.ayahs) ? audioJson.data.ayahs : null;
  const translations = (transJson && transJson.data && transJson.data.ayahs) ? transJson.data.ayahs : null;

  if(!ayahs){
    statusEl.textContent = '⚠️ Gagal muat teks Al-Quran dari API. Sila cuba semula.';
    return;
  }

  // Build UI
  statusEl.textContent = `Memaparkan Surah ${surahNum} — ${ayahs.length} ayat`;
  mushafEl.style.display = 'block';

  ayahs.forEach((ayahObj, idx) => {
    const ayahDiv = document.createElement('div');
    ayahDiv.className = 'ayah-block';

    // Arabic text: some APIs return .text or .textUthmani or .arab
    let arabicText = ayahObj.text || ayahObj.textUthmani || ayahObj.ar || '';
    // If Arabic contains HTML tags (span classes for tajwid), use innerHTML, else textContent.
    const arabicEl = document.createElement('div');
    arabicEl.className = 'arabic';
    if(/<[^>]+>/.test(arabicText)){
      arabicEl.innerHTML = arabicText;
    } else {
      // some Arabic strings may have isolated characters; set textContent (ensures correct escaping)
      arabicEl.textContent = arabicText;
    }

    // verse number bubble
    const num = document.createElement('div');
    num.className = 'verse-number';
    num.textContent = ayahObj.numberInSurah || (idx+1);

    // translation
    const transEl = document.createElement('div');
    transEl.className = 'translation small';
    let trText = '';
    if(translations && translations[idx]){
      // some translations have .text or .translation
      trText = translations[idx].text || translations[idx].translation || translations[idx].translation_text || '';
    }
    if(!trText){
      trText = ''; // optional: show "Terjemahan belum tersedia"
    }
    transEl.textContent = trText;

    // play ayah button (if audio URL present)
    const ayahAudioUrl = (ayahAudioUrls && ayahAudioUrls.length>idx) ? ayahAudioUrls[idx] : null;
    if(ayahAudioUrl){
      const playBtn = document.createElement('button');
      playBtn.textContent = '▶ Ayat';
      playBtn.style.marginTop = '12px';
      playBtn.onclick = ()=> {
        if(currentAudio){ currentAudio.pause(); currentAudio=null; }
        currentAudio = new Audio(ayahAudioUrl);
        currentAudio.play().catch(e=>alert('Audio play error: '+e.message));
      };
      // attach to translation container
      transEl.appendChild(document.createElement('br'));
      transEl.appendChild(playBtn);
    }

    ayahDiv.appendChild(num);
    ayahDiv.appendChild(arabicEl);
    if(trText) ayahDiv.appendChild(transEl);
    ayahContainer.appendChild(ayahDiv);
  });

  // prepare audio queue (whole surah) from ayahAudioUrls if have any
  audioQueue = ayahAudioUrls && ayahAudioUrls.some(u => u) ? ayahAudioUrls : [];

  // stop any playing audio
  stopPlayback();
}

// Playback queue for whole surah
function stopPlayback(){
  if(currentAudio){ currentAudio.pause(); currentAudio=null; }
  audioQueue = audioQueue.map(u=>u); // keep
  isPlayingQueue = false;
}
async function playQueueFrom(index=0){
  if(!audioQueue || audioQueue.length===0) { alert('Audio reciter tidak tersedia untuk surah ini.'); return; }
  if(index >= audioQueue.length) return;
  isPlayingQueue = true;
  for(let i=index;i<audioQueue.length;i++){
    const url = audioQueue[i];
    if(!isPlayingQueue) break;
    if(!url) continue;
    try{
      await playOne(url);
    }catch(e){
      console.warn('play err',e);
    }
  }
  isPlayingQueue = false;
}
function playOne(url){
  return new Promise((resolve,reject)=>{
    try{
      if(currentAudio){ currentAudio.pause(); currentAudio=null; }
      currentAudio = new Audio(url);
      currentAudio.onended = ()=> resolve();
      currentAudio.onerror = (e)=> { resolve(); }; // skip on error
      currentAudio.play().catch(e=> { console.warn('play fail',e); resolve(); });
    }catch(e){
      resolve();
    }
  });
}

playSurahBtn.addEventListener('click', ()=> {
  if(audioQueue && audioQueue.length>0){
    playQueueFrom(0);
  } else {
    // as fallback: try to fetch alquran.cloud reciter edition per-surah and queue again
    const surahNum = parseInt(surahSelect.value || 1);
    const reciter = reciterSelect.value || 'ar.alafasy';
    statusEl.textContent = 'Mencari audio reciter...';
    tryFetch(`https://api.alquran.cloud/v1/surah/${surahNum}/${reciter}`).then(j=>{
      if(j && j.data && j.data.ayahs){
        audioQueue = j.data.ayahs.map(a => a.audio || (a.audioSecondary && a.audioSecondary[0]) || null);
        if(audioQueue.some(u=>u)){ playQueueFrom(0); statusEl.textContent='Memainkan audio...'; return; }
      }
      alert('Audio untuk reciter ini tidak ditemui untuk surah ini.');
      statusEl.textContent = 'Audio tidak ditemui';
    });
  }
});

stopBtn.addEventListener('click', ()=> { stopPlayback(); statusEl.textContent='Dihenti'; });

surahSelect.addEventListener('change', (e)=> loadSurah(e.target.value));
reciterSelect.addEventListener('change', (e)=> {
  // when reciter change, reload audio & page but keep same surah
  const s = surahSelect.value || 1;
  loadSurah(s);
});

// initial
surahSelect.value = 1;
loadSurah(1);

</script>
</body>
</html>